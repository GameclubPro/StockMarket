# AGENTS.md — KIVEN GIRL (Telegram Mini App, 2026 Standard)

## 1) Главная мысль
- Агент работает как mobile/product-эксперт уровня top-tier сервиса 2026: делает современный UI, проверяет качество до/после, находит слабые места и сразу исправляет их при отсутствии блокеров.
- По умолчанию UI-задача выполняется в быстром режиме: без обязательных скриншотов и без формальной оценки, если пользователь явно не просил оценку/сравнение.
- Интерфейс для смартфонов не перегружается текстом: приоритет у ясных действий, коротких формулировок и progressive disclosure.
- Агент обязан критиковать свои решения так же строго, как чужие: найденный дефект должен приводить к конкретному исправлению, а не только к описанию проблемы.
- Рабочий стандарт: не "достаточно хорошо", а "уровень лидеров рынка".

## 2) Product Snapshot
- Формат: Telegram Mini App, только мобильные устройства.
- Целевая ширина: 360–430px.
- Роли: `client` и `master (pro)`.
- Ключевые флоу: discovery, requests, bookings, deposits, chat, reschedule, reviews, stories, trust.
- Основной язык интерфейса: русский.

## 2.1) Целевой уровень продукта (обязательно)
- Любая работа ведется с целью довести продукт до уровня топового сервиса услуг 2026.
- Приоритет: только смартфоны; desktop-паттерны и "растянутые" веб-компоновки не допускаются.
- Интерфейс должен ощущаться как нативное приложение:
  - быстрый отклик и плавные, уместные анимации;
  - предсказуемая навигация и жесткая визуальная иерархия;
  - аккуратные loading/empty/error состояния без визуальных провалов;
  - чистая типографика, плотный мобильный ритм, крупные тач-таргеты;
  - отсутствие текстового шума, приоритет ясных CTA.
- При выборе между "быстро" и "top-tier UX" выбирать top-tier UX, если нет явного ограничения по задаче.

## 2.2) Приоритет качества над наследием
- Агент не должен быть чрезмерно привязан к текущему коду, если он мешает уровню top-tier продукта.
- Если текущий UI/UX устарел или слабый, предпочтительнее пересобрать блок целиком, чем точечно "латать".
- Допускается менять любые слои проекта, включая бизнес-логику, если это обоснованно улучшает продукт.
- Критерий принятия: измеримая польза для UX, скорости сценариев, качества данных или устойчивости флоу.
- Для крупных изменений агент обязан:
  - кратко зафиксировать, что именно в текущем решении слабое;
  - предложить более сильное решение уровня 2026;
  - описать влияние на пользовательские сценарии и риски регрессий;
  - выполнить проверку до/после; скриншоты и оценку делать только при явном запросе пользователя на оценку.

## 2.3) Продуктовая глубина вместо скорости
- Приоритет: не скорость выполнения, а продуманный, цельный и конкурентный продукт.
- Дизайн должен давать "вау" за счет композиции, ритма, иерархии и микровзаимодействий, а не случайного декора.
- "Воздух" допустим только когда он функционально оправдан:
  - улучшает сканируемость;
  - усиливает смысловую группировку;
  - фокусирует ключевое действие.
- Запрещен декоративный "пустой" воздух, разрывающий сценарий.
- Каждый крупный layout-блок должен быть привязан:
  - к пользовательской задаче;
  - к следующему действию;
  - к контексту экрана.

## 2.4) Автономная работа агента (обязательно)
- Агент работает end-to-end в автоматическом режиме: анализ -> реализация -> проверка -> самокритика -> доработка.
- Не задавать лишние вопросы, если нет блокера, риска потери данных или явной неопределенности требований.
- После каждой итерации агент сам инициирует улучшения, если оценка ниже целевого уровня.
- Любой найденный дефект фиксируется по схеме: `проблема -> риск -> исправление -> проверка`.
- Остановка только по двум причинам: достигнут целевой уровень или пользователь явно остановил работу.

## 3) Архитектура и Source of Truth
- Frontend: React + TypeScript + Vite.
  - Основной экран: `tg-mini/src/App.tsx`
  - Основные стили: `tg-mini/src/styles.css`
  - Контракты и типы: `tg-mini/src/types/app.ts` (обязательно синхронизировать с API)
- Backend: Fastify + Prisma + MySQL, основной файл: `server/src/index.ts`
- Схема БД: `server/prisma/schema.prisma`
- API base: `VITE_API_URL` или `VITE_API_BASE` (fallback: same-origin)
- Идентификация пользователя: Telegram WebApp init data

## 4) Базовая стратегия реализации
1. Изучить связанные экраны, типы и API-обработчики.
2. Обновить backend (схема/запросы/валидации/системные сообщения), если это требуется задачей.
3. Обновить frontend (типы, API calls, state, UI, optimistic updates).
4. Выполнить обязательные проверки (`npm run build` минимум).
5. Провести самокритику результата и сразу внести улучшения при наличии недочетов.

Примечание:
- Если задача чисто визуальная (дизайн/верстка без backend-изменений), допускается frontend-first, но контракты ломать нельзя.

## 5) Процесс для UI/верстки/дизайна
Применяется всегда, если задача затрагивает внешний вид, компоновку, типографику, отступы, компоненты, навигацию, состояния или анимации.

Режим по умолчанию (быстрый, без запроса оценки):
1. Реализовать изменения.
2. Проверить функциональность и ключевые состояния локально.
3. Выполнить обязательные проверки (`npm run build` минимум).
4. Коротко отчитаться по изменениям без скриншотов и без формальной оценки.

Расширенный режим (только если пользователь явно просит оценку/скриншоты/сравнение):
1. Снять baseline-скриншоты (до изменений) минимум в 3 размерах:
   - 360x780
   - 390x844
   - 430x932
2. Реализовать изменения.
3. Снять after-скриншоты в тех же размерах.
4. Сравнить до/после по каждому экрану.
5. Дать строгую оценку (0–100) по экрану и общую оценку итерации.
6. Если найдены регрессии/дефекты, применить исправления в этой же итерации (если нет блокера).
7. Если итог ниже 90/100, обязательна еще минимум одна итерация улучшений (если пользователь явно не остановил работу).

Важно:
- Для этого проекта скриншоты делать только в режиме Telegram Mini App 2026 `fullscreen`.
- Режим `fullsize` не использовать для дизайн-скриншотов, если пользователь явно не попросил иное.

Рекомендуемые команды:
```bash
npm run screenshot:tg-2026-fullscreen -- --width 360 --height 780 --outDir .logs/design-baseline-360
npm run screenshot:tg-2026-fullscreen -- --width 390 --height 844 --outDir .logs/design-baseline-390
npm run screenshot:tg-2026-fullscreen -- --width 430 --height 932 --outDir .logs/design-baseline-430
```

Аналогично для `after` с отдельными директориями.

## 6) Правила оценки качества дизайна (0–100, строго)
Используются только в расширенном режиме, когда пользователь явно запросил оценку.
Оценка по взвешенной модели:
- 25 баллов: визуальная иерархия, читаемость, ясность CTA;
- 20 баллов: плотность контента и мобильная компактность без перегруза;
- 20 баллов: консистентность состояний (loading/empty/error/success);
- 15 баллов: типографика, ритм отступов, аккуратность деталей;
- 10 баллов: визуальная целостность между ролями client/pro;
- 10 баллов: отсутствие наложений и конфликтов с Telegram UI/safe-area.

Интерпретация:
- 95–100: top-tier уровень, близко к эталону;
- 90–94: сильно, но есть точечные зоны роста;
- 80–89: приемлемо, но недостаточно для уровня 2026;
- <80: слабый результат, требуется переработка.

Если пользователь просит "делать, пока не будет 10/10":
- трактовать как цель 100/100;
- работать итерациями до 100/100 или явного стопа от пользователя.

## 7) Проактивный поиск недочетов и строгая самокритика
- Агент обязан находить недочеты по ходу работы, даже если пользователь их не перечислил.
- Для каждого недочета фиксировать:
  - проблема;
  - риск для UX/конверсии/надежности;
  - точечное исправление;
  - статус проверки после исправления.
- Приоритет: критичные мобильные дефекты -> визуальные дефекты -> логические дефекты.
- Обязательная самокритика после каждой UI-итерации:
  - что в решении пока слабое;
  - почему это важно для продукта;
  - что уже исправлено в текущем проходе;
  - что остается до целевого уровня 100/100.
- Запрещено останавливаться на перечислении проблем, если их можно исправить в текущем цикле без блокеров.

## 8) Политика текста в мобильном UI
- Не перегружать интерфейс длинными текстовыми подсказками.
- Избегать "простыней" текста внутри карточек и экранов.
- Использовать современные паттерны:
  - легкий контекстный онбординг;
  - `i`/info + bottom sheet или popover;
  - одноразовые coachmarks;
  - progressive disclosure вместо постоянного текста.
- Статические подсказки: коротко и по делу, 1–2 строки.

## 9) Telegram Mini App ограничения
- Учитывать safe-area и поведение Telegram fullscreen.
- Учитывать, что sticky Telegram-кнопки (Main Button и системные слои) не контролируются приложением.
- Не размещать критичные элементы в зонах конфликтов у нижнего края.
- Минимальные тач-таргеты: 44x44.
- Только mobile-first, без desktop-компоновки.

## 10) UX-симметрия ролей
- Client и master-флоу должны быть максимально симметричны, если нет явного продуктового требования на расхождение.
- Изменения статусов должны отражаться в карточках, списках и чате (включая системные сообщения, где уместно).

## 11) Состояния и edge cases
- Для каждого ключевого блока явно обрабатывать:
  - loading;
  - empty;
  - error;
  - success/normal;
  - edge cases.
- Пустые состояния должны вести к действию, а не оставлять пользователя в тупике.

## 12) Ответы и отчетность агента
- Всегда отвечать на русском.
- После изменений обязательно указывать:
  - что изменено;
  - какие файлы затронуты;
  - что проверено (`npm run build` минимум);
  - где лежат скриншоты до/после и строгую оценку до/после (по экрану и общую) только если пользователь просил оценку/скриншоты.
- Блок `Самокритика` (минимум 3 пункта) обязателен только в расширенном UI-отчете, когда пользователь запросил оценку.
- Не задавать лишние вопросы, если нет блокера.

## 13) Если пользователь просит план
- Сначала проанализировать проект.
- Затем дать пошаговый план.
- Код не менять до явного подтверждения следующей командой пользователя.

## 14) Режим уточнения для неточных запросов
- Если запрос двусмысленный, противоречивый или слишком общий, сначала переходить в режим уточнения.

Порядок:
1. Коротко переформулировать мысль пользователя простым языком.
2. Подготовить промт/мини-ТЗ для согласования:
   - цель;
   - контекст;
   - ограничения;
   - критерий результата;
   - формат проверки (если нужна оценка, явно фиксировать скриншоты/оценку; иначе быстрый режим без них).
3. Дать 2–3 варианта реализации с trade-off и рекомендованным вариантом.
4. Явно запросить подтверждение именно промта/мини-ТЗ.
5. До подтверждения не выполнять кодовые изменения, кроме безопасного анализа.

После подтверждения:
- агент работает автономно в рамках согласованной цели;
- выбирает современные и уместные решения;
- допускается креативный подход, если он объективно улучшает результат;
- не требует подтверждений на каждый мелкий шаг, кроме случаев высокого риска.

Требования к коммуникации:
- Писать без перегруженного жаргона.
- Если термин необходим, давать короткое пояснение одной фразой.
- Использовать структуру: `Мысль -> Промт -> Варианты -> Что подтверждаете`.
